<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: core/x.page.js - 帮助手册</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script >
    window.onload = function()
    {
        var div = document.getElementById('main');
        if(div)
        {
            var windowWidth = null;

            if (window.innerWidth)
            {
                // all except Explorer
                if (document.documentElement.clientWidth)
                {
                    windowWidth = document.documentElement.clientWidth;
                }
                else
                {
                    windowWidth = window.innerWidth;
                }
            }
            else if (document.documentElement && document.documentElement.clientWidth)
            {
                // IE
                windowWidth = document.documentElement.clientWidth;
            }
            else if (document.body)
            {
                // other Explorers
                windowWidth = document.body.clientWidth;
            }

            div.style.width = (windowWidth - 260) + 'px';
        }
    }
    </script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default-fixed.css">
</head>

<body>

<nav>
    <h2><a href="index.html">首页</a></h2><h3>类<br />Classes</h3><ul><li><a href="x.date.newTime.html">newTime</a></li><li><a href="x.date.newTimeSpan.html">newTimeSpan</a></li><li><a href="x.newHashTable.html">newHashTable</a></li><li><a href="x.newQueue.html">newQueue</a></li><li><a href="x.newStack.html">newStack</a></li><li><a href="x.newStringBuilder.html">newStringBuilder</a></li><li><a href="x.newTimer.html">newTimer</a></li><li><a href="x.ui.mask.newMaskWrapper.html">newMaskWrapper</a></li><li><a href="x.ui.pkg.tabs.newTabs.html">newTabs</a></li><li><a href="x.ui.pkg.tree.newTreeView.html">newTreeView</a></li><li><a href="x.ui.tooltip.newTooltip.html">newTooltip</a></li><li><a href="x.ui.tooltip.newWarnTooltip.html">newWarnTooltip</a></li><li><a href="x.ui.tree.newTreeNode.html">newTreeNode</a></li></ul><h3>名称空间<br />Namespaces</h3><ul><li><a href="x.html">x</a></li><li><a href="x.browser.html">x.browser</a></li><li><a href="x.browser.features.html">x.browser.features</a></li><li><a href="x.color.html">x.color</a></li><li><a href="x.cookies.html">x.cookies</a></li><li><a href="x.css.html">x.css</a></li><li><a href="x.date.html">x.date</a></li><li><a href="x.debug.html">x.debug</a></li><li><a href="x.dom.html">x.dom</a></li><li><a href="x.encoding.html">x.encoding</a></li><li><a href="x.encoding.html.html">x.encoding.html</a></li><li><a href="x.encoding.unicode.html">x.encoding.unicode</a></li><li><a href="x.expressions.html">x.expressions</a></li><li><a href="x.guid.html">x.guid</a></li><li><a href="x.net.html">x.net</a></li><li><a href="x.net.request.html">x.net.request</a></li><li><a href="x.page.html">x.page</a></li><li><a href="x.randomText.html">x.randomText</a></li><li><a href="x.string.html">x.string</a></li><li><a href="x.ui.html">x.ui</a></li><li><a href="x.ui.animation.html">x.ui.animation</a></li><li><a href="x.ui.animation.tween.html">x.ui.animation.tween</a></li><li><a href="x.ui.animation.tween.back.html">x.ui.animation.tween.back</a></li><li><a href="x.ui.animation.tween.bounce.html">x.ui.animation.tween.bounce</a></li><li><a href="x.ui.animation.tween.circ.html">x.ui.animation.tween.circ</a></li><li><a href="x.ui.animation.tween.cubic.html">x.ui.animation.tween.cubic</a></li><li><a href="x.ui.animation.tween.elastic.html">x.ui.animation.tween.elastic</a></li><li><a href="x.ui.animation.tween.expo.html">x.ui.animation.tween.expo</a></li><li><a href="x.ui.animation.tween.quad.html">x.ui.animation.tween.quad</a></li><li><a href="x.ui.animation.tween.quart.html">x.ui.animation.tween.quart</a></li><li><a href="x.ui.animation.tween.quint.html">x.ui.animation.tween.quint</a></li><li><a href="x.ui.animation.tween.sine.html">x.ui.animation.tween.sine</a></li><li><a href="x.ui.dialogs.html">x.ui.dialogs</a></li><li><a href="x.ui.drag.html">x.ui.drag</a></li><li><a href="x.ui.mask.html">x.ui.mask</a></li><li><a href="x.ui.pkg.html">x.ui.pkg</a></li><li><a href="x.ui.pkg.slide.html">x.ui.pkg.slide</a></li><li><a href="x.ui.pkg.tabs.html">x.ui.pkg.tabs</a></li><li><a href="x.ui.pkg.tree.html">x.ui.pkg.tree</a></li><li><a href="x.ui.tooltip.html">x.ui.tooltip</a></li><li><a href="x.ui.util.html">x.ui.util</a></li><li><a href="x.ui.windows.html">x.ui.windows</a></li></ul>
</nav>

<div id="main">

    <h1 class="page-title">Source: core/x.page.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>﻿// -*- ecoding=utf-8 -*-

/**
* @namespace page
* @memberof x
* @description 页面管理
*/
x.page = {

    /*#region 函数:back()*/
    /**
    * 返回上一个页面. window.history.back() 函数的别名
    * @method back
    * @memberof x.page
    */
    back: function()
    {
        window.history.back(arguments);
    },
    /*#endregion*/

    /*region 函数:close()*/
    /**
    * 关闭窗口
    * @method close
    * @memberof x.page
    */
    close: function()
    {
        try
        {
            window.opener = null;
            window.open('', '_self');
            window.close();
        }
        catch (ex)
        {
            window.close();
        }
    },
    /*endregion*/

    /*region 函数:refreshParentWindow()*/
    /**
    * 刷新父级窗口.
    * @method refreshParentWindow
    * @memberof x.page
    */
    refreshParentWindow: function()
    {
        if (typeof (window.opener) == 'object')
        {
            x.debug.error('未定义父级窗口。');
        }

        // 如果有父级窗口，调用父级窗口刷新函数
        if (x.type(window.opener) == 'object' && x.isFunction(window.opener.window$refresh$callback))
        {
            window.opener.window$refresh$callback();
        }
        else
        {
            x.debug.log('父级窗口未定义 window$refresh$callback() 函数。');
        }
    },
    /*endregion*/

    /**
    * 获取页面范围信息
    * @method getRange
    * @memberof x.page
    */
    getRange: function()
    {
        var pageWidth, pageHeight, windowWidth, windowHeight;

        var xScroll, yScroll;

        if (window.innerHeight && window.scrollMaxY)
        {
            xScroll = window.innerWidth + window.scrollMaxX;
            yScroll = window.innerHeight + window.scrollMaxY;
        }
        else if (document.body.scrollHeight > document.body.offsetHeight)
        {
            // all but Explorer Mac
            xScroll = document.body.scrollWidth;
            yScroll = document.body.scrollHeight;
        }
        else
        {
            // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari
            xScroll = document.body.offsetWidth;
            yScroll = document.body.offsetHeight;
        }

        //console.log('self.innerWidth:' + self.innerWidth);
        //console.log('document.documentElement.clientWidth:' + document.documentElement.clientWidth);

        if (window.innerHeight)
        {
            // all except Explorer
            if (document.documentElement.clientWidth)
            {
                windowWidth = document.documentElement.clientWidth;
            }
            else
            {
                windowWidth = window.innerWidth;
            }

            windowHeight = window.innerHeight;
        }
        else if (document.documentElement && document.documentElement.clientHeight)
        {
            // IE
            windowWidth = document.documentElement.clientWidth;
            windowHeight = document.documentElement.clientHeight;
        }
        else if (document.body)
        {
            // other Explorers
            windowWidth = document.body.clientWidth;
            windowHeight = document.body.clientHeight;
        }

        // for small pages with total height less then height of the viewport
        if (yScroll &lt; windowHeight)
        {
            pageHeight = windowHeight;
        }
        else
        {
            pageHeight = yScroll;
        }

        //console.log("xScroll " + xScroll)
        //console.log("windowWidth " + windowWidth)

        // for small pages with total width less then width of the viewport
        if (xScroll &lt; windowWidth)
        {
            pageWidth = xScroll;
        }
        else
        {
            pageWidth = windowWidth;
        }

        //console.log("pageWidth " + pageWidth)

        return {
            width: pageWidth,
            height: pageHeight,
            windowWidth: windowWidth,
            windowHeight: windowHeight
        };
    },

    /*
    * 获取页面高度
    */
    getHeight: function()
    {
        // return document.body.scrollHeight;
        return x.page.getRange().height;
    },

    /*
    * 获取页面宽度
    */
    getWidth: function()
    {
        // return document.body.scrollWidth;
        return x.page.getRange().width;
    },

    /*
    * 获取页面可视区域高度
    */
    getViewHeight: function()
    {
        // return document.documentElement.clientHeight;
        return x.page.getRange().windowHeight;
    },

    /*
    * 获取页面可视区域宽度
    */
    getViewWidth: function()
    {
        // return document.documentElement.clientWidth;
        return x.page.getRange().windowWidth;
    },

    /**
    * 获取元素在页面中的坐标 Top 坐标
    */
    getElementTop: function(element)
    {
        return element.getBoundingClientRect().top;
        /*
        var actualTop = element.offsetTop;
        var current = element.offsetParent;
        while (current !== null)
        {
        actualTop += current.offsetTop;
        current = current.offsetParent;
        }
        return actualTop;
        */
    },

    /**
    * 获取元素在页面中的坐标 Left 坐标
    */
    getElementLeft: function(element)
    {
        return element.getBoundingClientRect().left;
        /*
        var actualLeft = element.offsetLeft;
        var current = element.offsetParent;
        while (current !== null)
        {
        actualLeft += current.offsetLeft;
        current = current.offsetParent;
        }
        return actualLeft;
        */
    },

    /**
    * 获取元素在页面可视区域中的坐标 Top 坐标
    */
    getElementViewTop: function(element)
    {
        return element.getBoundingClientRect().top;
        /*
        var actualTop = element.offsetTop;
        var current = element.offsetParent;
        while (current !== null)
        {
        actualTop += current.offsetTop;
        current = current.offsetParent;
        }
        if (document.compatMode == "BackCompat")
        {
        var elementScrollTop = document.body.scrollTop;
        } else
        {
        var elementScrollTop = document.documentElement.scrollTop;
        }
        return actualTop - elementScrollTop;*/
    },

    /**
    * 获取元素在页面可视区域中的坐标 Left 坐标
    */
    getElementViewLeft: function(element)
    {
        return element.getBoundingClientRect().left;
        /* 
        var actualLeft = element.offsetLeft;
        var current = element.offsetParent;
        while (current !== null)
        {
        actualLeft += current.offsetLeft;
        current = current.offsetParent;
        }
        if (document.compatMode == "BackCompat")
        {
        var elementScrollLeft = document.body.scrollLeft;
        } else
        {
        var elementScrollLeft = document.documentElement.scrollLeft;
        }
        return actualLeft - elementScrollLeft;
        */
    },

    /**
    * 获取元素在页面可视区域中的坐标 Left 坐标
    */
    getElementAbsoluteTop: function(element)
    {
        var top = x.page.getElementViewTop(element);

        var parents = $(element).parents();

        for (var i = 0; i &lt; parents.length; i++)
        {
            var parent = $(parents[i]);

            if (parent.css('position') === 'absolute' && parent.css('top') !== 'auto')
            {
                top = top - Number(parent.css('top').replace('px', ''));
            }

            x.page.getElementViewTop(parents[i])
        }

        return top;
    },

    /**
    * 获取元素的范围
    */
    getElementRange: function(element)
    {
        var display = $(element).css('display');

        // Safari bug
        if (display != 'none' && display != null)
        {
            return { width: element.offsetWidth, height: element.offsetHeight };
        }

        // All *Width and *Height properties give 0 on elements with display none,
        // so enable the element temporarily
        var style = element.style;

        var originalVisibility = style.visibility;
        var originalPosition = style.position;
        var originalDisplay = style.display;

        style.visibility = 'hidden';
        style.position = 'absolute';
        style.display = 'block';

        var originalWidth = element.clientWidth;
        var originalHeight = element.clientHeight;

        style.display = originalDisplay;
        style.position = originalPosition;
        style.visibility = originalVisibility;

        return { width: originalWidth, height: originalHeight };
    },

    /**
    * 返回页面顶部
    */
    goTop: function()
    {
        window.scrollTo(0, 0);
        // document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    },

    /*
    * 竖向滚动
    */
    scroll: function(value)
    {
        window.scrollTo(0, value);
    },

    /**
    * 重新调整元素的大小
    *
    * @element	: 元素
    * @height	: 高度
    * @width	: 宽度
    */
    resize: function(element, height, width)
    {
        $(element).css({
            height: document.body.clientHeight - height + "px",
            width: document.body.clientWidth - width + "px"
        });
    },

    /*
    * 模拟窗口最大化.
    */
    setFullScreen: function()
    {
        // 作废
        //
        // var width = screen.availWidth - (document.layers ? 10 : -8);
        // var height = screen.availHeight - (document.layers ? 20 : -8);

        // window.resizeTo(width, height);

        // x.Page.setTitle(width + '-' + height);
    },

    /**
    * 打印Xml的文档
    *
    * @text : 文本信息
    */
    printXml: function(text)
    {
        if (text == null) { return ''; }

        return text.replace(/&lt;/g, '&lt;').replace(/>/g, '&gt;');
    },

    /**
    * 禁止拷贝
    */
    forbidCopy: {
        /*
        * Hotkey 即为热键的键值,是ASII码.
        * Ctronl : 17.
        * C : 99
        * V :
        */
        hotkeys: [67],

        message: '当前页面【禁止拷贝】信息。',

        /*#region 函数:listen()*/

        listen: function()
        {
            if ($(document.getElementById('forbidCopy$activate')).val() === '1')
            {
                // 禁止拷贝
                x.page.forbidCopy.activate();
            }
        },
        /*#endregion*/

        /*#region 函数:activate(e)*/
        activate: function(e)
        {
            var event = window.event ? window.event : e;

            if (document.layers)
            {
                document.captureEvents(event.MOUSEDOWN);

                document.captureEvents(event.KEYDOWN);
            }

            // 上下文菜单
            document.oncontextmenu = function() { return false; };

            // 全选功能
            document.onselectstart = function(event)
            {
                event = x.getEventObject(event);

                event.returnValue = false;
            };

            // 鼠标
            document.onmousedown = x.page.forbidCopy.mouse;

            // 键盘
            document.onkeydown = x.page.forbidCopy.keyboard;
        },
        /*#endregion*/

        /*#region 函数:mouse(e)*/
        mouse: function(e)
        {
            var event = window.event ? window.event : e;

            if (document.all)
            {
                if (event.button == 1 || event.button == 2 || event.button == 3)
                {
                    window.document.oncontextmenu = function() { return false; }
                }
            }

            if (document.layers)
            {
                if (event.which == 3)
                {
                    window.document.oncontextmenu = function() { return false; }
                }
            }
        },
        /*#endregion*/

        /*#region 函数:keyboard(e)*/
        keyboard: function(e)
        {
            var event = window.event ? window.event : e;

            var hotkeys = x.page.forbidCopy.hotkeys;

            var result = false;

            for (var i = 0; i &lt; hotkeys.length; i++)
            {
                if (hotkeys[i] == event.keyCode)
                {
                    result = true;
                    break;
                }
            }

            // event.shiftKey | event.altKey | event.ctrlKey
            if (event.ctrlKey || result)
            {
                alert(x.page.forbidCopy.message);

                x.debug.log(x.page.forbidCopy.message);

                return false;
            }
        }
        /*#endregion*/
    },

    /*
    * 创建分页对象
    */
    newPagesHelper: function(pageSize)
    {
        if (pageSize === undefined || pageSize === '') { pageSize = 10; }

        var helper = {

            rowIndex: 0,

            pageSize: pageSize,

            rowCount: 0,

            pageCount: 0,

            currentPage: 0,

            firstPage: 0,

            previousPage: 0,

            nextPage: 0,

            lastPage: 0,

            whereClause: '',

            orderBy: '',

            /*
            * 加载对象信息
            */
            load: function(pages)
            {
                if (typeof (pages.pageSize) != 'undefined') { this.pageSize = Number(pages.pageSize); }

                if (typeof (pages.rowCount) != 'undefined') { this.rowCount = Number(pages.rowCount); }

                if (typeof (pages.rowIndex) != 'undefined') { this.rowIndex = Number(pages.rowIndex); }

                if (typeof (pages.firstPage) != 'undefined') { this.firstPage = Number(pages.firstPage); }

                if (typeof (pages.previousPage) != 'undefined') { this.previousPage = Number(pages.previousPage); }

                if (typeof (pages.nextPage) != 'undefined') { this.nextPage = Number(pages.nextPage); }

                if (typeof (pages.lastPage) != 'undefined') { this.lastPage = Number(pages.lastPage); }

                if (typeof (pages.whereClause) != 'undefined') { this.whereClause = pages.whereClause; }

                if (typeof (pages.orderBy) != 'undefined') { this.orderBy = pages.orderBy; }
            },

            /*
            * 设置上一页的参数.
            */
            setPreviousPage: function(value)
            {
                this.previousPage = value - 1;

                if (this.previousPage &lt; 1)
                {
                    this.previousPage = 1;
                }
            },

            /**
            * 设置下一页的参数.
            */
            setNextPage: function(value)
            {
                this.nextPage = value + 1;

                if (this.nextPage > this.lastPage)
                {
                    this.nextPage = this.lastPage;
                }
            },

            /**
            * 设置页数
            */
            getPagesNumber: function(format, value, length)
            {
                // may be overwrite here. ^_^
                //
                // x.page.newPagesHelper.prototype.getPagesNumber
                //

                var outString = '';

                var page = value;

                var counter;

                if (value - length > 0)
                {
                    value -= length;
                }
                else
                {
                    value = 1;
                }

                counter = value + (length * 2) + 1;

                if (counter > this.lastPage)
                {
                    value = this.lastPage - (length * 2);
                }

                for (var i = value; i &lt; counter; i++)
                {
                    if (i &lt; 1) { continue; }

                    if (i > this.lastPage) { break; }

                    if (format.indexOf('{0}') > -1)
                    {
                        outString += '&lt;a href="' + format.replace('{0}', i) + '" >';
                    }
                    else
                    {
                        outString += '&lt;a href="javascript:' + format + '(' + i + ');" >';
                    }

                    outString += ((page == i) ? ('&lt;strong>' + i + '&lt;/strong>') : i);
                    outString += '&lt;/a> ';
                }

                return outString;
            },

            /**
            * 解析为分页菜单信息
            */
            tryParseMenu: function(format)
            {
                var outString = '';

                outString += '&lt;div class="nav-pager" >';
                outString += '&lt;div class="nav-pager-1" >';
                outString += '共有' + this.rowCount + '条信息 当前' + (this.rowIndex + 1) + '-' + (this.rowIndex + this.pageSize) + '信息 ';

                if (format.indexOf('{0}') > -1)
                {
                    outString += '&lt;a href="' + format.replace('{0}', this.firstPage) + '">首页&lt;/a> ';
                    outString += '&lt;a href="' + format.replace('{0}', this.previousPage) + '">上一页&lt;/a> ';
                    outString += this.getPagesNumber(format, this.currentPage, 2)
                    outString += '&lt;a href="' + format.replace('{0}', this.nextPage) + '">下一页&lt;/a> ';
                    outString += '&lt;a href="' + format.replace('{0}', this.lastPage) + '">末页&lt;/a> ';
                }
                else
                {
                    outString += '&lt;a href="javascript:' + format + '(' + this.firstPage + ');">首页&lt;/a> ';
                    outString += '&lt;a href="javascript:' + format + '(' + this.previousPage + ');">上一页&lt;/a> ';
                    outString += this.getPagesNumber(format, this.currentPage, 2)
                    outString += '&lt;a href="javascript:' + format + '(' + this.nextPage + ');">下一页&lt;/a> ';
                    outString += '&lt;a href="javascript:' + format + '(' + this.lastPage + ');">末页&lt;/a> ';
                }

                outString += '&lt;/div>';
                outString += '&lt;div class="clear" >&lt;/div>';
                outString += '&lt;/div>';

                return outString;
            },

            toXml: function()
            {
                var outString = '';

                outString += '&lt;pages>';
                outString += '&lt;rowIndex>' + this.rowIndex + '&lt;/rowIndex>';
                outString += '&lt;pageSize>' + this.pageSize + '&lt;/pageSize>';
                outString += '&lt;rowCount>' + this.rowCount + '&lt;/rowCount>';
                outString += '&lt;pageCount>' + this.pageCount + '&lt;/pageCount>';
                outString += '&lt;currentPage>' + this.currentPage + '&lt;/currentPage>';
                outString += '&lt;firstPage>' + this.firstPage + '&lt;/firstPage>';
                outString += '&lt;previousPage>' + this.previousPage + '&lt;/previousPage>';
                outString += '&lt;nextPage>' + this.nextPage + '&lt;/nextPage>';
                outString += '&lt;lastPage>' + this.lastPage + '&lt;/lastPage>';
                outString += '&lt;whereClause>&lt;![CDATA[' + this.whereClause + ']]>&lt;/whereClause>';
                outString += '&lt;orderBy>&lt;![CDATA[' + this.orderBy + ']]>&lt;/orderBy>';
                outString += '&lt;/pages>';

                return outString;
            }
        };

        return helper;
    }
}
</code></pre>
        </article>
    </section>




</div>

<br clear="both">

<footer>
    文档生成工具 <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> , 生成时间 2014-07-31T01:23:53.029Z.
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
